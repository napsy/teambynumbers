<html>
	<head>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
	<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script
  src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"
  integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E="
  crossorigin="anonymous"></script>

<style>
body {
	margin: 0px !important;
}

#banner {
	width: 100%;
	color: white;
	padding: 20px;
	height: 140px;
	background: #44464f;
	font-size: 50px;
	text-align: center;

}
#content {
	margin: auto !important;
	margin-top: 50px !important;
	width: 600px !important;
	padding: 30px !important;
	background: #e1eff4;
	border-radius: 15px;
}
</style>
<script type="text/javascript">
function cancel() {
	window.location.href = '/';
};

function submit() {
	var eTeam         = $('#team').val(),
		eMembers      = $('#members').val(),
		eCycle        = $('#cycle').val(),
		eLead         = $('#lead').val(),
		eBugsReported = $('#bugs-reported').val(),
		eBugsSquashed = $('#bugs-squashed').val(),
		eValue        = $('#value').val(),
		eReport       = $('#report').val(),
		eDeploys      = $('#deploys').val();

		var data = JSON.stringify({
				Team:eTeam,
				MemberCount: parseInt(eMembers, 10),
				CycleTime: parseInt(eCycle, 10),
				LeadTime: parseInt(eLead, 10),
				BugsReported: parseInt(eBugsReported, 10),
				BugsSquashed: parseInt(eBugsSquashed, 10),
				DeployCount: parseInt(eDeploys, 10),
				ValueScore: parseFloat(eValue),
				ReportURL: eReport
		});

		$.ajax ({
			type: "POST",
			url: '/api/v1/reports',
			contentType : 'application/json',
			async: false,
			data: data,
			success: function () {
				$('#error-window').css("display", "none");
				$('#ok-window').css("display", "block");
				setTimeout(function() {
					window.location.href = '/';
				}, 1000);
			},
			error: function(e) {
				$('#error-message').html("There was an error submitting your report, the server returned:<p><br>" + "<code>"+e.responseText+"</code></p>");
				$('#error-window').css("display", "block");
			}
		})
};

function uniq(a) {
	return a.sort().filter(function(item, pos, ary) {
		return !pos || item != ary[pos - 1];
	});
}

window.onload = function() {
	$('#error-window').css("display", "none");
	$('#ok-window').css("display", "none");

	$.ajax ({
		type: "GET",
		url: '/api/v1/teams',
		contentType : 'application/json',
		dataType: "json",
		async: false,
		success: function (data) {
			$('#error-window').css("display", "none");
			$('#teams').autocomplete({
				source: data 
			});
			var str = '( ';
			data.forEach(el => { str += el+' ' });
			str += ')';
			$('#team-list').html(str);
		},
		error: function(e) {
			$('#error-message').html("There was an error fetching list of teams, the server returned:<p><br>" + "<code>"+e.responseText+"</code></p>");
			$('#error-window').css("display", "block");
		}
	})
};
</script>
<title>TeamByNumbers</title>
	</head>
	<body>
		<div id="banner"><a href="/"><span style="color: red; font-weight: bold;">team</span><span style="">by</span><span style="color: grey; font-weight:
				 bold;">numbers</span></a></div>
		<div id="content">
			<h1 class="title">New Report</h1>
			<p class="subtitle">Well done! You're ready to add new team stats.</p>

			<div id="error-window" class="notification is-danger">
				 <div id="error-message"></div>
			</div>
			<div id="ok-window" class="notification is-success">
			  <div>Success!</div>
			</div>
			<label class="label">Team</label>
			<div id="team-list" style="font-size: small;"></div>
			<input id="team" class="input" type="text" placeholder="short, e.g. JIRA names" />
			<label class="label">Member count</label>
			<input id="members" class="input" type="text" placeholder="how many people participated" />
			<label class="label">Cycle time</label>
			<input id="cycle" class="input" type="text" placeholder="average time a task spent in WIP lane" />
			<label class="label">Lead time</label>
			<input id="lead" class="input" type="text" placeholder="number of done tasks in this period"/>
			<label class="label">Bugs reported <span style="font-size: small;"><i>(optional)</i></span></label>
			<input id="bugs-reported" class="input" type="text" placeholder="will be set to 0 if empty" />
			<label class="label">Bugs squashed <span style="font-size: small;"><i>(optional)</i></span></label>
			<input id="bugs-squashed" class="input" type="text" placeholder="will be set to 0 if empty"/>
			<label class="label">Deploy count <span style="font-size: small;"><i>(optional)</i></span></label>
			<input id="deploys" class="input" type="text" placeholder="number of deploys made to production"/>
			<label class="label">Value score <span style="font-size: small;"><i>(optional)</i></span></label>
			<input id="value" class="input" type="text" placeholder="will be set to 0 if empty"/>
			<label class="label">Report URL <span style="font-size: small;"><i>(optional)</i></span></label>
			<input id="report" class="input" type="text" placeholder="URL for a full report document" /><br>
			<br><br>
			<div class="field is-grouped">
				<div class="control">
					<button class="button is-link" onclick="submit()" >Submit</button>
				</div>
				<div class="control">
					<button class="button is-link is-light" onclick="cancel()">Cancel</button>
				</div>
			</div>
		</div>
	</body>

</html>
